<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virtual Mixer Trainer</title>
  <style>
    :root{
      --bg:#0e1116;--panel:#151a22;--panel2:#1b222c;--text:#e8eef9;--muted:#9fb0c6;--accent:#4da3ff;--good:#7ce38b;--warn:#ffca63;--danger:#ff7a7a;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#0d1117,#0b0e13 50%,#0c1016);color:var(--text)}
    header{position:sticky;top:0;background:rgba(13,17,23,.85);backdrop-filter: blur(6px);border-bottom:1px solid #1f2630;z-index:5}
    header .wrap{display:flex;align-items:center;gap:16px;padding:12px 16px;}
    h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.3px}
    .pill{border:1px solid #2b3442;padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
    .grid{display:grid;grid-template-columns:repeat(6,minmax(220px,1fr));gap:14px;padding:16px}
    .strip{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #1f2630;border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:10px}
    .strip h3{margin:0 0 4px;font-size:13px;color:#d7e3f8;letter-spacing:.3px}
    .section{background:#0f141b;border:1px solid #212938;border-radius:12px;padding:10px}
    .row{display:flex;align-items:center;gap:8px;margin:6px 0}
    label{font-size:12px;color:#b7c6db}
    input[type="range"]{width:100%}
    input[type="number"]{width:70px;background:#0c1117;color:var(--text);border:1px solid #233042;border-radius:8px;padding:6px}
    .btn{background:#121823;color:#cfe1fb;border:1px solid #283343;padding:6px 10px;border-radius:10px;font-size:12px;cursor:pointer}
    .btn:hover{border-color:#3a4c66}
    .btn.red{border-color:#5b2a2a;color:#ffc9c9}
    .toggle{display:flex;gap:8px}
    .toggle button{flex:1}
    .meter{height:72px;background:#0b0f15;border:1px solid #243145;border-radius:8px;position:relative;overflow:hidden}
    .meter .bar{position:absolute;bottom:0;left:0;right:0;height:0;background:linear-gradient(180deg,#6be47a,#ffe27a 70%,#ff8b8b)}
    .small{font-size:11px;color:#93a7c0}
    .master{grid-column:1/-1;display:grid;grid-template-columns:repeat(6,1fr);gap:14px;padding:0 16px 16px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #1f2630;border-radius:16px;padding:12px}
    .row.inline>*{flex:1}
    select, .select{width:100%;background:#0c1117;color:var(--text);border:1px solid #233042;border-radius:10px;padding:8px}
    .helper{padding:12px 16px;color:#cdd9ed}
    .helper h2{font-size:14px;margin:0 0 8px}
    .helper ul{margin:6px 0 0 16px}
    .badge{display:inline-flex;align-items:center;gap:6px;background:#0f1620;border:1px solid #293447;color:#c6d5ef;border-radius:999px;padding:6px 10px;font-size:12px}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0d131b;border:1px solid #293447;border-bottom-color:#1c2734;padding:2px 6px;border-radius:6px;font-size:11px}
    .note{font-size:12px;color:#a9bad5}
    .hr{height:1px;background:#1f2630;margin:10px 0}
    .foot{display:flex;gap:8px;flex-wrap:wrap}
    @media (max-width: 1100px){
      .grid{grid-template-columns:repeat(3,minmax(220px,1fr));}
      .master{grid-template-columns:repeat(3,1fr);}
    }
    @media (max-width: 700px){
      .grid{grid-template-columns:repeat(1,minmax(220px,1fr));}
      .master{grid-template-columns:repeat(1,1fr);}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>üéöÔ∏è Virtual Mixer Trainer</h1>
      <span class="pill">Load your own stems ‚Ä¢ Practice live & studio workflows</span>
      <button id="playAll" class="btn">‚ñ∂ Play All</button>
      <button id="pauseAll" class="btn">‚è∏ Pause All</button>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <label class="small">Scenario</label>
        <select id="scenario">
          <option value="none">‚Äî None (manual) ‚Äî</option>
          <option value="worship_live">Worship Band (Live)</option>
          <option value="studio_pop">Pop Vocals (Studio)</option>
        </select>
        <button id="applyScenario" class="btn">Apply</button>
      </div>
    </div>
  </header>

  <div class="helper">
    <h2>How to use</h2>
    <div class="note">Load audio per channel (e.g., lead vocal, BGVs, guitar, keys, drums). Adjust <span class="kbd">TRIM</span> first, then EQ, then fader. Use <span class="kbd">AUX</span> to send to reverb. Practice mute/solo, panning, and master balance. Designed for <b>training</b>‚Äîno files are uploaded; everything runs locally in your browser.</div>
  </div>

  <section class="grid" id="grid"></section>

  <section class="master">
    <div class="card section">
      <h3>Master Bus</h3>
      <div class="row"><label>Master Fader</label><input id="masterFader" type="range" min="0" max="1.5" step="0.01" value="1"></div>
      <div class="row"><label>Reverb Return</label><input id="reverbReturn" type="range" min="0" max="1" step="0.01" value="0.2"></div>
      <div class="row"><label>Master Meter</label><div id="masterMeter" class="meter" aria-label="master meter"><div class="bar"></div></div></div>
      <div class="row foot">
        <span class="badge">Tip: Aim for peaks around -6 dBFS (green/yellow), avoid red.</span>
      </div>
    </div>
    <div class="card section" style="grid-column:span 5">
      <h3>Training Notes</h3>
      <ul class="note">
        <li><b>Gain staging:</b> Set <span class="kbd">TRIM</span> so the channel meter is healthy (green/yellow) when the source is loudest.</li>
        <li><b>HPF:</b> Engage High-Pass Filter on vocals to remove rumble (start 80‚Äì120 Hz).</li>
        <li><b>EQ:</b> Use gentle cuts to clean up muddiness (200‚Äì400 Hz). Add presence for lead (2‚Äì5 kHz), air (10‚Äì12 kHz).</li>
        <li><b>Pan:</b> Keep lead vocal center; place BGVs left/right for width. Guitars can be spread; bass & kick center.</li>
        <li><b>Aux/Reverb:</b> Send small amounts to create space; less for live than studio to control clarity & feedback.</li>
      </ul>
    </div>
  </section>

  <script>
  // ======== Audio Engine ========
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const masterGain = ctx.createGain();
  const analyserMaster = ctx.createAnalyser();
  masterGain.connect(analyserMaster).connect(ctx.destination);

  // Reverb bus (Convolver + return gain)
  const convolver = ctx.createConvolver();
  const reverbReturn = ctx.createGain();
  reverbReturn.gain.value = 0.2;
  convolver.connect(reverbReturn).connect(masterGain);

  // Generate a simple impulse response (fast algorithmic reverb)
  function makeImpulse(seconds=2.4, decay=2.0){
    const rate = ctx.sampleRate;
    const len = rate * seconds;
    const impulse = ctx.createBuffer(2, len, rate);
    for(let ch=0; ch<2; ch++){
      const data = impulse.getChannelData(ch);
      for(let i=0;i<len;i++){
        data[i] = (Math.random()*2-1) * Math.pow(1 - i/len, decay);
      }
    }
    return impulse;
  }
  convolver.buffer = makeImpulse();

  const channelDefs = [
    { id:'voxLead', label:'Lead Vocal' },
    { id:'bgv1',    label:'BGV Left' },
    { id:'bgv2',    label:'BGV Right' },
    { id:'gtr',     label:'Guitar' },
    { id:'keys',    label:'Keys' },
    { id:'drums',   label:'Drums' },
  ];

  const state = { channels:{}, soloAny:false };

  function createChannel(def){
    const strip = document.createElement('div');
    strip.className='strip';
    strip.innerHTML = `
      <h3>${def.label}</h3>
      <div class="section">
        <div class="row inline">
          <label>Audio File</label>
          <input type="file" accept="audio/*" data-role="file">
        </div>
        <div class="row"><label>TRIM</label><input data-role="trim" type="range" min="0" max="4" step="0.01" value="1"></div>
        <div class="row"><label>HPF</label>
          <input data-role="hpfToggle" type="checkbox"> <span class="small">Enable</span>
          <input data-role="hpfFreq" type="range" min="20" max="300" step="1" value="100">
        </div>
        <div class="row"><label>EQ Low (shelf)</label><input data-role="eqLow" type="range" min="-12" max="12" step="0.1" value="0"></div>
        <div class="row"><label>EQ Mid Gain</label><input data-role="eqMidGain" type="range" min="-12" max="12" step="0.1" value="0"></div>
        <div class="row"><label>EQ Mid Freq</label><input data-role="eqMidFreq" type="range" min="200" max="6000" step="1" value="1500"></div>
        <div class="row"><label>EQ Mid Q</label><input data-role="eqMidQ" type="range" min="0.2" max="12" step="0.1" value="1.0"></div>
        <div class="row"><label>EQ High (shelf)</label><input data-role="eqHigh" type="range" min="-12" max="12" step="0.1" value="0"></div>
        <div class="row"><label>Pan</label><input data-role="pan" type="range" min="-1" max="1" step="0.01" value="0"></div>
        <div class="row"><label>AUX ‚Üí Reverb</label><input data-role="aux" type="range" min="0" max="1" step="0.01" value="0.2"></div>
        <div class="row"><label>Fader</label><input data-role="fader" type="range" min="0" max="1.5" step="0.01" value="1"></div>
        <div class="row"><label>Meter</label><div class="meter" aria-label="channel meter"><div class="bar"></div></div></div>
        <div class="row toggle">
          <button data-role="mute" class="btn">Mute</button>
          <button data-role="solo" class="btn">Solo</button>
        </div>
      </div>
    `;

    // Build Web Audio graph per channel
    const media = new Audio();
    media.loop = true;
    media.crossOrigin = 'anonymous';
    media.preload = 'auto';

    const src = ctx.createMediaElementSource(media);
    const preGain = ctx.createGain(); // TRIM
    const hpf = ctx.createBiquadFilter();
    hpf.type = 'highpass';
    hpf.frequency.value = 100;
    hpf.Q.value = 0.707;

    const eqLow = ctx.createBiquadFilter(); eqLow.type='lowshelf'; eqLow.frequency.value=100;
    const eqMid = ctx.createBiquadFilter(); eqMid.type='peaking'; eqMid.frequency.value=1500; eqMid.Q.value=1.0;
    const eqHigh = ctx.createBiquadFilter(); eqHigh.type='highshelf'; eqHigh.frequency.value=8000;

    const pan = ctx.createStereoPanner();
    const auxSend = ctx.createGain();
    const postFader = ctx.createGain(); // channel fader
    const analyser = ctx.createAnalyser(); analyser.fftSize=256;

    // Routing
    src.connect(preGain)
       .connect(hpf)
       .connect(eqLow)
       .connect(eqMid)
       .connect(eqHigh)
       .connect(pan)
       .connect(postFader)
       .connect(analyser)
       .connect(masterGain);

    // Aux: tap signal post-EQ, pre-fader (like typical pre/post‚Äîhere we use post-EQ pre-fader)
    eqHigh.connect(auxSend).connect(convolver);

    const ui = {
      file: strip.querySelector('[data-role=file]'),
      trim: strip.querySelector('[data-role=trim]'),
      hpfToggle: strip.querySelector('[data-role=hpfToggle]'),
      hpfFreq: strip.querySelector('[data-role=hpfFreq]'),
      eqLow: strip.querySelector('[data-role=eqLow]'),
      eqMidGain: strip.querySelector('[data-role=eqMidGain]'),
      eqMidFreq: strip.querySelector('[data-role=eqMidFreq]'),
      eqMidQ: strip.querySelector('[data-role=eqMidQ]'),
      eqHigh: strip.querySelector('[data-role=eqHigh]'),
      pan: strip.querySelector('[data-role=pan]'),
      aux: strip.querySelector('[data-role=aux]'),
      fader: strip.querySelector('[data-role=fader]'),
      mute: strip.querySelector('[data-role=mute]'),
      solo: strip.querySelector('[data-role=solo]'),
      meter: strip.querySelector('.meter .bar'),
    };

    // UI wiring
    ui.file.addEventListener('change', e=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      media.src = url;
      media.play().catch(()=>{});
      ctx.resume();
    });

    ui.trim.addEventListener('input', ()=> preGain.gain.value = parseFloat(ui.trim.value));
    ui.hpfToggle.addEventListener('change', ()=>{
      hpf.frequency.value = ui.hpfToggle.checked ? parseFloat(ui.hpfFreq.value) : 20;
    });
    ui.hpfFreq.addEventListener('input', ()=>{
      if(ui.hpfToggle.checked) hpf.frequency.value = parseFloat(ui.hpfFreq.value);
    });
    ui.eqLow.addEventListener('input', ()=> eqLow.gain.value = parseFloat(ui.eqLow.value));
    ui.eqMidGain.addEventListener('input', ()=> eqMid.gain.value = parseFloat(ui.eqMidGain.value));
    ui.eqMidFreq.addEventListener('input', ()=> eqMid.frequency.value = parseFloat(ui.eqMidFreq.value));
    ui.eqMidQ.addEventListener('input', ()=> eqMid.Q.value = parseFloat(ui.eqMidQ.value));
    ui.eqHigh.addEventListener('input', ()=> eqHigh.gain.value = parseFloat(ui.eqHigh.value));
    ui.pan.addEventListener('input', ()=> pan.pan.value = parseFloat(ui.pan.value));
    ui.aux.addEventListener('input', ()=> auxSend.gain.value = parseFloat(ui.aux.value));
    ui.fader.addEventListener('input', ()=> postFader.gain.value = parseFloat(ui.fader.value));

    ui.mute.addEventListener('click', ()=>{
      const muted = postFader.gain.value>0.0001;
      postFader.gain.value = muted? 0 : parseFloat(ui.fader.value);
      ui.mute.textContent = muted? 'Unmute':'Mute';
      updateSoloMute();
    });

    ui.solo.addEventListener('click', ()=>{
      strip.dataset.solo = strip.dataset.solo==='1' ? '0' : '1';
      ui.solo.textContent = strip.dataset.solo==='1' ? 'Unsolo' : 'Solo';
      updateSoloMute();
    });

    function drawMeter(){
      const arr = new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteFrequencyData(arr);
      let val = 0; for(const v of arr) val = Math.max(val, v);
      const pct = val/255; // 0..1
      ui.meter.style.height = Math.round(pct*100)+"%";
      requestAnimationFrame(drawMeter);
    }
    drawMeter();

    state.channels[def.id] = { def, strip, media, nodes:{src,preGain,hpf,eqLow,eqMid,eqHigh,pan,auxSend,postFader,analyser} , ui };
    return strip;
  }

  function updateSoloMute(){
    const anySolo = Object.values(state.channels).some(ch => ch.strip.dataset.solo==='1');
    state.soloAny = anySolo;
    for(const ch of Object.values(state.channels)){
      const soloed = ch.strip.dataset.solo==='1';
      const target = (!anySolo || soloed) ? parseFloat(ch.ui.fader.value) : 0;
      ch.nodes.postFader.gain.value = target;
      ch.ui.mute.textContent = target>0 ? 'Mute' : 'Unmute';
    }
  }

  // Build UI grid
  const grid = document.getElementById('grid');
  channelDefs.forEach(def => grid.appendChild(createChannel(def)));

  // Master controls
  const masterFader = document.getElementById('masterFader');
  const reverbReturnKnob = document.getElementById('reverbReturn');
  const masterMeter = document.querySelector('#masterMeter .bar');
  masterFader.addEventListener('input', ()=> masterGain.gain.value = parseFloat(masterFader.value));
  reverbReturnKnob.addEventListener('input', ()=> reverbReturn.gain.value = parseFloat(reverbReturnKnob.value));

  function drawMaster(){
    const arr = new Uint8Array(analyserMaster.frequencyBinCount);
    analyserMaster.getByteFrequencyData(arr);
    let val = 0; for(const v of arr) val = Math.max(val, v);
    const pct = val/255;
    masterMeter.style.height = Math.round(pct*100)+"%";
    requestAnimationFrame(drawMaster);
  }
  analyserMaster.fftSize=256; drawMaster();

  // Transport
  const playAll = document.getElementById('playAll');
  const pauseAll = document.getElementById('pauseAll');
  playAll.addEventListener('click', ()=>{
    ctx.resume();
    for(const ch of Object.values(state.channels)){
      if(ch.media.src) ch.media.play().catch(()=>{});
    }
  });
  pauseAll.addEventListener('click', ()=>{
    for(const ch of Object.values(state.channels)) ch.media.pause();
  });

  // Scenarios / Presets
  function applyScenario(name){
    const C = state.channels;
    if(name==='worship_live'){
      // Lead vocal focused, conservative reverb, HPF on vocals, pan BGVs L/R
      if(C.voxLead){
        C.voxLead.ui.hpfToggle.checked = true; C.voxLead.ui.hpfFreq.value=110; C.voxLead.ui.hpfToggle.dispatchEvent(new Event('change'));
        C.voxLead.ui.eqMidGain.value = -2; C.voxLead.ui.eqMidGain.dispatchEvent(new Event('input'));
        C.voxLead.ui.eqMidFreq.value = 300; C.voxLead.ui.eqMidFreq.dispatchEvent(new Event('input'));
        C.voxLead.ui.eqHigh.value = 2; C.voxLead.ui.eqHigh.dispatchEvent(new Event('input'));
        C.voxLead.ui.aux.value = 0.18; C.voxLead.ui.aux.dispatchEvent(new Event('input'));
        C.voxLead.ui.pan.value = 0; C.voxLead.ui.pan.dispatchEvent(new Event('input'));
      }
      if(C.bgv1){ C.bgv1.ui.hpfToggle.checked = true; C.bgv1.ui.hpfFreq.value=120; C.bgv1.ui.hpfToggle.dispatchEvent(new Event('change')); C.bgv1.ui.pan.value=-0.35; C.bgv1.ui.pan.dispatchEvent(new Event('input')); C.bgv1.ui.eqHigh.value=1.5; C.bgv1.ui.eqHigh.dispatchEvent(new Event('input')); C.bgv1.ui.aux.value=0.22; C.bgv1.ui.aux.dispatchEvent(new Event('input')); }
      if(C.bgv2){ C.bgv2.ui.hpfToggle.checked = true; C.bgv2.ui.hpfFreq.value=120; C.bgv2.ui.hpfToggle.dispatchEvent(new Event('change')); C.bgv2.ui.pan.value= 0.35; C.bgv2.ui.pan.dispatchEvent(new Event('input')); C.bgv2.ui.eqHigh.value=1.5; C.bgv2.ui.eqHigh.dispatchEvent(new Event('input')); C.bgv2.ui.aux.value=0.22; C.bgv2.ui.aux.dispatchEvent(new Event('input')); }
      if(C.gtr){ C.gtr.ui.hpfToggle.checked = true; C.gtr.ui.hpfFreq.value=90; C.gtr.ui.hpfToggle.dispatchEvent(new Event('change')); C.gtr.ui.eqMidGain.value=-2; C.gtr.ui.eqMidGain.dispatchEvent(new Event('input')); C.gtr.ui.eqMidFreq.value=250; C.gtr.ui.eqMidFreq.dispatchEvent(new Event('input')); C.gtr.ui.pan.value=0.25; C.gtr.ui.pan.dispatchEvent(new Event('input')); }
      if(C.keys){ C.keys.ui.hpfToggle.checked = true; C.keys.ui.hpfFreq.value=80; C.keys.ui.hpfToggle.dispatchEvent(new Event('change')); C.keys.ui.eqMidGain.value=-1.5; C.keys.ui.eqMidGain.dispatchEvent(new Event('input')); C.keys.ui.eqMidFreq.value=300; C.keys.ui.eqMidFreq.dispatchEvent(new Event('input')); C.keys.ui.pan.value=-0.25; C.keys.ui.pan.dispatchEvent(new Event('input')); C.keys.ui.aux.value=0.15; C.keys.ui.aux.dispatchEvent(new Event('input')); }
      if(C.drums){ C.drums.ui.hpfToggle.checked = false; C.drums.ui.eqLow.value=2; C.drums.ui.eqLow.dispatchEvent(new Event('input')); C.drums.ui.eqMidGain.value=-2; C.drums.ui.eqMidGain.dispatchEvent(new Event('input')); C.drums.ui.eqMidFreq.value=350; C.drums.ui.eqMidFreq.dispatchEvent(new Event('input')); C.drums.ui.pan.value=0; C.drums.ui.pan.dispatchEvent(new Event('input')); C.drums.ui.aux.value=0.08; C.drums.ui.aux.dispatchEvent(new Event('input')); }
      document.getElementById('reverbReturn').value = 0.18; reverbReturn.gain.value = 0.18;
    }
    else if(name==='studio_pop'){
      if(C.voxLead){ C.voxLead.ui.hpfToggle.checked = true; C.voxLead.ui.hpfFreq.value=100; C.voxLead.ui.hpfToggle.dispatchEvent(new Event('change')); C.voxLead.ui.eqMidGain.value=-1.5; C.voxLead.ui.eqMidGain.dispatchEvent(new Event('input')); C.voxLead.ui.eqMidFreq.value=250; C.voxLead.ui.eqMidFreq.dispatchEvent(new Event('input')); C.voxLead.ui.eqHigh.value=3; C.voxLead.ui.eqHigh.dispatchEvent(new Event('input')); C.voxLead.ui.aux.value=0.28; C.voxLead.ui.aux.dispatchEvent(new Event('input')); }
      if(C.bgv1){ C.bgv1.ui.hpfToggle.checked = true; C.bgv1.ui.hpfFreq.value=120; C.bgv1.ui.hpfToggle.dispatchEvent(new Event('change')); C.bgv1.ui.pan.value=-0.4; C.bgv1.ui.pan.dispatchEvent(new Event('input')); C.bgv1.ui.eqHigh.value=2; C.bgv1.ui.eqHigh.dispatchEvent(new Event('input')); C.bgv1.ui.aux.value=0.32; C.bgv1.ui.aux.dispatchEvent(new Event('input')); }
      if(C.bgv2){ C.bgv2.ui.hpfToggle.checked = true; C.bgv2.ui.hpfFreq.value=120; C.bgv2.ui.hpfToggle.dispatchEvent(new Event('change')); C.bgv2.ui.pan.value= 0.4; C.bgv2.ui.pan.dispatchEvent(new Event('input')); C.bgv2.ui.eqHigh.value=2; C.bgv2.ui.eqHigh.dispatchEvent(new Event('input')); C.bgv2.ui.aux.value=0.32; C.bgv2.ui.aux.dispatchEvent(new Event('input')); }
      if(C.gtr){ C.gtr.ui.hpfToggle.checked = true; C.gtr.ui.hpfFreq.value=100; C.gtr.ui.hpfToggle.dispatchEvent(new Event('change')); C.gtr.ui.eqMidGain.value=-3; C.gtr.ui.eqMidGain.dispatchEvent(new Event('input')); C.gtr.ui.eqMidFreq.value=400; C.gtr.ui.eqMidFreq.dispatchEvent(new Event('input')); C.gtr.ui.eqHigh.value=1; C.gtr.ui.eqHigh.dispatchEvent(new Event('input')); C.gtr.ui.pan.value=0.5; C.gtr.ui.pan.dispatchEvent(new Event('input')); }
      if(C.keys){ C.keys.ui.hpfToggle.checked = true; C.keys.ui.hpfFreq.value=90; C.keys.ui.hpfToggle.dispatchEvent(new Event('change')); C.keys.ui.eqMidGain.value=-2; C.keys.ui.eqMidGain.dispatchEvent(new Event('input')); C.keys.ui.eqMidFreq.value=350; C.keys.ui.eqMidFreq.dispatchEvent(new Event('input')); C.keys.ui.pan.value=-0.5; C.keys.ui.pan.dispatchEvent(new Event('input')); C.keys.ui.aux.value=0.22; C.keys.ui.aux.dispatchEvent(new Event('input')); }
      if(C.drums){ C.drums.ui.hpfToggle.checked = false; C.drums.ui.eqLow.value=2.5; C.drums.ui.eqLow.dispatchEvent(new Event('input')); C.drums.ui.eqMidGain.value=-3; C.drums.ui.eqMidGain.dispatchEvent(new Event('input')); C.drums.ui.eqMidFreq.value=300; C.drums.ui.eqMidFreq.dispatchEvent(new Event('input')); C.drums.ui.pan.value=0; C.drums.ui.pan.dispatchEvent(new Event('input')); C.drums.ui.aux.value=0.12; C.drums.ui.aux.dispatchEvent(new Event('input')); }
      document.getElementById('reverbReturn').value = 0.26; reverbReturn.gain.value = 0.26;
    }
  }

  document.getElementById('applyScenario').addEventListener('click', ()=>{
    const sel = document.getElementById('scenario').value;
    applyScenario(sel);
  });

  // Unlock audio on first gesture (mobile safety)
  window.addEventListener('click', ()=> ctx.resume(), { once:true });
  </script>
</body>
</html>
